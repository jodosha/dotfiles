#!/usr/bin/env bash
set -euo pipefail
IFS=$'\n\t'

root=~/Code/hanami
declare -a directories=(utils validations router controller cli rspec hanami)
declare -a gems=(hanami-utils hanami-validations hanami-router hanami-controller hanami-cli hanami-rspec hanami)

uninstall_gems() {
  echo "== Uninstalling gems.."
  for rubygem in "${gems[@]}"
  do
    gem uninstall -axI $rubygem
  done
}

install_gems() {
  echo "== Installing gems.."
  for directory in "${directories[@]}"
  do
    pushd $root/$directory > /dev/null
    bundle install > /dev/null
    bundle exec rake install
    echo "Installed $directory"
    popd > /dev/null
  done
}

main() {
  uninstall_gems
  install_gems
}

main
